

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Restart system services after an OS update &mdash; Documentation for Clear Linux* project</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'zh_CN',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="Set the time" href="time.html" />
    <link rel="prev" title="Query package info from upstream repository" href="query-upstream.html" />

<link rel="stylesheet" href="../../_static/tcs_theme.css" type="text/css" />


</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #007ab2" >
          

          
            <a href="../../index.html" class="icon icon-home"> Clear Linux* Project Docs
          

          
            
            <img src="../../_static/clearlinux.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Clear Linux</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Language Versions</dt>
        
          <dd><a href="/clearlinux/latest/guides/maintenance/restart.html">English</a></dd>
        
          <dd><a href="/clearlinux/latest/zh_CN/guides/maintenance/restart.html">Chinese</a></dd>
        
      </dl>
      <dl>
        <dt>Document Versions</dt>
        
          <dd><a href="/clearlinux/latest/guides/maintenance/restart.html">latest</a></dd>
        
          <dd><a href="/clearlinux/L19.01/guides/maintenance/restart.html">L19.01</a></dd>
        
      </dl>
      <dl>
        <dt>clearlinux.org links</dt>
          <dd>
            <a href="https://www.clearlinux.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/clearlinux/clear-linux-documentation">GitHub</a>
          </dd>
      </dl>
    </div>
  </div>
  
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get-started/get-started.html">Get started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tooling/tooling.html">How to Clear</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../guides.html">Guides</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../guides.html#maintenance">Maintenance</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="architect-lifecycle.html">Architect the life-cycle of Clear Linux* OS</a></li>
<li class="toctree-l3"><a class="reference internal" href="assign-static-ip.html">Assign a static IP address</a></li>
<li class="toctree-l3"><a class="reference internal" href="bulk-provision.html">Bulk provision</a></li>
<li class="toctree-l3"><a class="reference internal" href="cpu-performance.html">CPU Power and Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="developer-workstation.html">Developer Workstation</a></li>
<li class="toctree-l3"><a class="reference internal" href="download-verify-decompress.html">Download, verify, and decompress a Clear Linux* OS image</a></li>
<li class="toctree-l3"><a class="reference internal" href="enable-user-space.html">Create and enable a new user space</a></li>
<li class="toctree-l3"><a class="reference internal" href="fix-broken-install.html">Fix a broken installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="hostname.html">Modify hostname</a></li>
<li class="toctree-l3"><a class="reference internal" href="increase-virtual-disk-size.html">Increase virtual disk size of an image</a></li>
<li class="toctree-l3"><a class="reference internal" href="query-upstream.html">Query package info from upstream repository</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Restart system services after an OS update</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-it-works">How it works</a></li>
<li class="toctree-l4"><a class="reference internal" href="#basic-options">Basic options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monitor-options">Monitor options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#telemetry">Telemetry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="time.html">Set the time</a></li>
<li class="toctree-l3"><a class="reference internal" href="validate-signatures.html">Validate signatures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../deploy-at-scale.html">Deploy at Scale</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../guides.html#network">Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides.html#kernel">Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides.html#stacks">Stacks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ/faq.html">FAQ</a></li>
</ul>

            
          

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Clear Linux* Project Docs</a>
        
      </nav>


      <div class="wy-nav-content">

<header id="header">
  <div class="padding-md--left-right">

    <div class="header__site_info">
           <div class="header__site_info_name">
             <a href ="https://clearlinux.org"> Clear Linux* Project</a>
           </div>
    </div>
    <nav class="header__menu">
        <ul class="header__menu_list">
                         <li class="header__menu_list_item green  ">
                <a tabindex='1' href="https://clearlinux.org/about">About</a>
              </li>
                         <li class="header__menu_list_item purple  ">
                <a tabindex='1' href="https://clearlinux.org/developer">Developer</a>
              </li>
                         <li class="header__menu_list_item blue  ">
                <a tabindex='1' href="https://clearlinux.org/software">Software</a>
              </li>
        </ul>
    </nav>

  </div>



</header>


        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../guides.html">Guides</a> &raquo;</li>
        
      <li>Restart system services after an OS update</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/clearlinux/clear-linux-documentation/blob/rtd-theme/source/guides/maintenance/restart.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="restart-system-services-after-an-os-update">
<span id="restart"></span><h1>Restart system services after an OS update</h1>
<p>This guide describes how to use the <strong class="command">clr-service-restart</strong> tool.</p>
<div class="contents local topic" id="id1">
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id2">Overview</a></li>
<li><a class="reference internal" href="#how-it-works" id="id3">How it works</a></li>
<li><a class="reference internal" href="#basic-options" id="id4">Basic options</a></li>
<li><a class="reference internal" href="#monitor-options" id="id5">Monitor options</a></li>
<li><a class="reference internal" href="#example" id="id6">Example</a></li>
<li><a class="reference internal" href="#telemetry" id="id7">Telemetry</a></li>
<li><a class="reference internal" href="#conclusion" id="id8">Conclusion</a></li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id2">Overview</a></h2>
<p>Clear Linux* OS includes a <strong class="command">clr-service-restart</strong> tool that shows which
system daemons require a restart.</p>
<p><strong class="command">clr-service-restart</strong> reads various files in the <code class="file docutils literal notranslate"><span class="pre">procfs</span></code>
filesystem provided by the kernel and relies on <strong class="command">systemd</strong> to
determine which services to restart.</p>
</div>
<div class="section" id="how-it-works">
<h2><a class="toc-backref" href="#id3">How it works</a></h2>
<p><strong class="command">clr-service-restart</strong> implements a whitelist to identify which
daemons can be restarted. As a system administrator, you can customize the
default Clear Linux OS OS whitelist using <strong class="command">allow</strong> or <strong class="command">disallow</strong> options
for restarting system services. When a software update occurs,
<strong class="command">clr-service-restart</strong> consults the whitelist to see if a service daemon
is allowed to be restarted or not.</p>
</div>
<div class="section" id="basic-options">
<h2><a class="toc-backref" href="#id4">Basic options</a></h2>
<p><strong class="command">clr-service-restart</strong> has three basic options: <strong class="command">allow</strong>,
<strong class="command">disallow</strong>, and <strong class="command">default</strong>.</p>
<div class="section" id="allow">
<h3>allow</h3>
<p>The <strong class="command">allow</strong> option identifies a daemon to restart after an OS software
update. The <strong class="command">clr-service-restart</strong> daemon creates a symlink in
<code class="file docutils literal notranslate"><span class="pre">/etc/clr-service-restart</span></code> as a record. The example below tells
<strong class="command">clr-service-restart</strong> to restart the <em>tallow</em> daemon after an
OS software update.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo clr-service-restart allow tallow.service
</pre></div>
</div>
</div>
<div class="section" id="disallow">
<h3>disallow</h3>
<p>The <strong class="command">disallow</strong> option tells <strong class="command">clr-service-restart</strong> not to
restart the specified daemon even if the OS defaults permit the daemon to be
restarted. The <strong class="command">clr-service-restart</strong> daemon creates a symlink in
<code class="file docutils literal notranslate"><span class="pre">/etc/clr-service-restart</span></code> that points to <code class="file docutils literal notranslate"><span class="pre">/dev/null</span></code> as a
record. The example below tells <strong class="command">clr-service-restart</strong> not to
restart the <em>rngd</em> daemon after an OS software update.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo clr-service-restart disallow rngd
</pre></div>
</div>
</div>
<div class="section" id="default">
<h3>default</h3>
<p>The <strong class="command">default</strong> option makes <strong class="command">clr-service-restart</strong> revert back
to the OS defaults and delete any symlink  in <code class="file docutils literal notranslate"><span class="pre">/etc/clr-service-restart</span></code>.
The example below  tells <strong class="command">clr-service-restart</strong> to restart <em>rngd</em>
automatically again, because <em>rngd</em> is whitelisted for automatic service
restarts by default in Clear Linux OS.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo clr-service-restart default rngd
</pre></div>
</div>
</div>
</div>
<div class="section" id="monitor-options">
<h2><a class="toc-backref" href="#id5">Monitor options</a></h2>
<p><strong class="command">clr-service-restart</strong> works in the background and is invoked with
<strong class="command">swupd</strong> automatically. Review the journal output to verify that
services are restarted after an OS software update.</p>
<p>If you pass both options (<strong class="command">-a</strong> and <strong class="command">-n</strong>) described below,
<strong class="command">clr-service-restart</strong> displays a complete list of system services
that require a restart. Use both options to verify that all desired daemons
are restarted.</p>
<div class="section" id="n-option">
<h3>-n option</h3>
<p>The <strong class="command">-n</strong> option makes <strong class="command">clr-service-restart</strong> perform no restarts.
Instead it displays the services that could potentially be restarted. When used,
<strong class="command">clr-service-restart</strong> outputs a list of messages showing:</p>
<ul class="simple">
<li>Which service needs a restart.</li>
<li>What unit it is.</li>
<li>Why it needs a restart.</li>
<li>Which command is required to restart the unit.</li>
</ul>
</div>
<div class="section" id="a-option">
<h3>-a option</h3>
<p>The <strong class="command">-a</strong> option makes <strong class="command">clr-service-restart</strong> consider all system
services, not only the ones that are whitelisted. Because the default whitelist
in Clear Linux OS is relatively short, you can use this option to restart all impacted
services when you log in on the system.</p>
</div>
</div>
<div class="section" id="example">
<h2><a class="toc-backref" href="#id6">Example</a></h2>
<p>In the example below, <strong class="command">clr-service-restart</strong> is invoked with both the
<strong class="command">-a</strong> and <strong class="command">-n</strong> options, which displays a complete list of system
services that require a restart.</p>
<p>Command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo clr-service-restart -a -n
</pre></div>
</div>
<p>Sample output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">upower.service: needs a restart (a library dependency was updated)</span>
<span class="go">/usr/bin/systemctl --no-ask-password try-restart upower.service</span>
<span class="go">NetworkManager.service: needs a restart (a library dependency was</span>
<span class="go">updated)</span>
<span class="go">/usr/bin/systemctl --no-ask-password try-restart NetworkManager.service</span>
<span class="go">....</span>
</pre></div>
</div>
</div>
<div class="section" id="telemetry">
<h2><a class="toc-backref" href="#id7">Telemetry</a></h2>
<p><strong class="command">clr-service-restart</strong> may cause problems such as a short service
outage when a daemon is being restarted, or if a daemon fails to properly
restart. To minimize issues, <strong class="command">clr-service-restart</strong> creates a
telemetry record and sends it to the optional Clear Linux OS telemetry service if both
conditions below are met:</p>
<ul class="simple">
<li>If a unit fails to automatically restart after an OS update.</li>
<li>If that unit resides in the system location <code class="file docutils literal notranslate"><span class="pre">/usr/lib/systemd/system</span></code>.</li>
</ul>
<p>If you do not install the Clear Linux OS telemetrics bundle, the data is discarded. If
you install the telemetrics bundle and you opt to send telemetry, then the
system unit name is sent to the Clear Linux OS telemetry service. We evaluate the
report and update the whitelist to remove services that are not safe to
restart.</p>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id8">Conclusion</a></h2>
<p>The Clear Linux OS team enjoys coming up with simple and efficient solutions to make
your work easier. We made a GitHub* project of <strong class="command">clr-service-restart</strong>
and we invite you to look at the code, share your thoughts, and work with us
on improving the project. You can find the project at:</p>
<p><a class="reference external" href="https://github.com/clearlinux/clr-service-restart">https://github.com/clearlinux/clr-service-restart</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="time.html" class="btn btn-neutral float-right" title="Set the time" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="query-upstream.html" class="btn btn-neutral float-left" title="Query package info from upstream repository" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, many
      <span class="lastupdated">
        最后更新于 7月 25, 2019.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>


      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  

<script type="text/javascript" src="../../_static/tcs_theme.js"></script>



</body>
</html>